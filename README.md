# PVE Ubuntu Server 安装脚本

这是一个用于在 Proxmox VE (PVE) 系统中自动安装 Ubuntu Server 的脚本。脚本提供了友好的菜单界面，允许用户自定义各种安装参数。

## 功能特性

- ✅ 支持 Ubuntu 20.04/22.04/24.04 LTS
- ✅ 自动下载 Ubuntu 云镜像
- ✅ 自动配置网络设置 (IP、网关、DNS)
- ✅ 支持 SSH 密钥认证
- ✅ 自动安装常用软件包
- ✅ 菜单式配置界面
- ✅ 输入验证和错误处理
- ✅ 彩色输出界面

## 系统要求

- Proxmox VE 6.0 或更高版本
- Root 权限
- 网络连接 (用于下载镜像)
- 足够的存储空间

## 安装步骤

### 1. 下载脚本

```bash
# 给脚本添加执行权限
chmod +x pve_ubuntu_installer.sh
```

### 2. 运行脚本

```bash
# 以 root 用户运行
sudo ./pve_ubuntu_installer.sh
```

### 3. 配置参数

脚本启动后会显示配置菜单，您可以设置以下参数：

- **VM ID**: 虚拟机 ID (100-999999)
- **VM 名称**: 虚拟机名称
- **内存大小**: 虚拟机内存 (MB)
- **CPU 核心数**: CPU 核心数量
- **磁盘大小**: 磁盘容量 (如 20G, 50G)
- **网络配置**: IP 地址、网关、DNS
- **用户信息**: 用户名和密码
- **SSH 密钥**: SSH 公钥文件路径 (可选)
- **Ubuntu 版本**: 选择 Ubuntu 版本

### 4. 开始安装

配置完成后，选择"开始安装"选项，脚本将：

1. 检查 PVE 环境
2. 下载 Ubuntu 云镜像
3. 创建 cloud-init 配置
4. 创建虚拟机
5. 配置网络和用户
6. 启动虚拟机

## 配置说明

### 默认配置

- VM ID: 100
- VM 名称: ubuntu-server
- 内存: 2048MB
- CPU: 2 核心
- 磁盘: 20G
- IP: 192.168.1.100
- 网关: 192.168.1.1
- DNS: 8.8.8.8
- 用户名: ubuntu
- Ubuntu 版本: 22.04

### 网络配置

脚本会自动配置静态 IP 地址。请确保：

- IP 地址在您的网络范围内
- 网关地址正确
- DNS 服务器可访问

### SSH 密钥

如果您想使用 SSH 密钥认证：

1. 准备您的 SSH 公钥文件
2. 在菜单中设置 SSH 密钥路径
3. 脚本会自动将公钥添加到虚拟机中

## 安装的软件包

脚本会自动安装以下软件包：

- qemu-guest-agent
- curl
- wget
- vim
- htop

## 连接虚拟机

安装完成后，您可以使用以下命令连接到虚拟机：

```bash
ssh ubuntu@<IP地址>
```

## 故障排除

### 常见问题

1. **权限错误**
   ```
   错误: 此脚本需要 root 权限运行
   ```
   解决：使用 `sudo` 运行脚本

2. **PVE 环境检查失败**
   ```
   错误: 此脚本需要在 PVE 节点上运行
   ```
   解决：确保在 PVE 节点上运行脚本

3. **VM ID 已存在**
   ```
   错误: VM ID 100 已存在
   ```
   解决：选择其他 VM ID

4. **镜像下载失败**
   ```
   镜像下载失败
   ```
   解决：检查网络连接，确保可以访问 Ubuntu 镜像服务器

5. **虚拟机启动失败**
   ```
   虚拟机启动失败
   ```
   解决：检查存储空间和网络配置

### 日志查看

如果遇到问题，可以查看以下日志：

```bash
# 查看虚拟机状态
qm status <VM_ID>

# 查看虚拟机配置
qm config <VM_ID>

# 查看 cloud-init 日志
qm terminal <VM_ID>
```

## 脚本结构

```
pve_ubuntu_installer.sh
├── 配置变量
├── 工具函数
├── 菜单系统
├── 环境检查
├── 镜像下载
├── 虚拟机创建
└── 安装流程
```

## 安全注意事项

- 脚本会创建具有 sudo 权限的用户
- 密码以明文形式存储在 cloud-init 配置中
- 建议安装完成后更改默认密码
- 考虑使用 SSH 密钥替代密码认证

## 更新日志

### v1.0
- 初始版本
- 支持 Ubuntu 20.04/22.04/24.04
- 菜单式配置界面
- 自动网络配置
- SSH 密钥支持

## 许可证

此脚本仅供学习和个人使用。请根据您的需求进行修改。

## 贡献

欢迎提交问题报告和改进建议。